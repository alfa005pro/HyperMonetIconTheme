name: Update Lawnicons APK

on:
  workflow_dispatch: # 支持手动点击运行
  schedule:
    - cron: '0 0 * * 1' # 每周一自动检查更新

jobs:
  update-apk:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Download Latest Lawnicons
        run: |
          # 获取 GitHub 上最新的 Release 下载链接
          DOWNLOAD_URL=$(curl -s https://api.github.com/repos/LawnchairLauncher/Lawnicons/releases/latest | grep "browser_download_url.*apk" | cut -d '"' -f 4)
          echo "正在从 $DOWNLOAD_URL 下载最新版..."
          curl -L -o Lawnicons.apk "$DOWNLOAD_URL"

      - name: Commit and Push
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add Lawnicons.apk
          # 只有在文件有变动时才提交
          git diff --quiet && git diff --staged --quiet || (git commit -m "Update Lawnicons.apk to latest version" && git push)
